import{a as W,j as v,r as c,F as b,l as M,T as k,b as w,c as L,t as x,R as F,d as S}from"./vendor.6976df3f.js";const B=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};B();const C="_contentWrapper_cfial_1",O="_contentSigned_cfial_11";var I={contentWrapper:C,contentSigned:O};const G="_loginBoxWrapper_1argr_1",E="_signInWithGithub_1argr_16";var N={loginBoxWrapper:G,signInWithGithub:E};const g=W.create({baseURL:"http://localhost:4000"}),s=v.exports.jsx,r=v.exports.jsxs,y=c.exports.createContext({});function U(e){const[a,t]=c.exports.useState(null),l="https://github.com/login/oauth/authorize?scope=user&client_id=a74955676c1099e28bc9";async function n(i){const h=await g.post("authenticate",{code:i}),{token:d,user:p}=h.data;t(p),localStorage.setItem("@dowhile:token",d),g.defaults.headers.common.authorization=`Bearer ${d}`}function o(){t(null),window.localStorage.removeItem("@dowhile:token")}return c.exports.useEffect(()=>{window.localStorage.getItem("@dowhile:token")&&g.get("profile").then(h=>{t(h.data)})},[]),c.exports.useEffect(()=>{const i=window.location.href;if(i.includes("?code=")){const[d,p]=i.split("?code=");console.log({githubCode:p,urlWithoutCode:d}),window.history.pushState({},"",d),n(p)}},[]),s(y.Provider,{value:{signInUrl:l,user:a,signOut:o},children:e.children})}function _(){return c.exports.useContext(y)}function j(){const{signInUrl:e}=_();return r("div",{className:N.loginBoxWrapper,children:[s("strong",{children:"Entre e compartilhe sua mensagem"}),r("a",{href:e,className:N.signInWithGithub,children:[s(b,{size:22,color:"#09090a"}),"Entrar com Github"]})]})}const z="_messageListWrapper_o0m7d_1",R="_messageList_o0m7d_1",$="_message_o0m7d_1",A="_messageContent_o0m7d_26",P="_messageUser_o0m7d_30",D="_userImage_o0m7d_36";var m={messageListWrapper:z,messageList:R,message:$,messageContent:A,messageUser:P,userImage:D},Q="/nlw-heat-react-ghpages/assets/logo.2a5e2196.svg";const f=[],T=M("http://localhost:4000");T.on("new_message",e=>{f.push(e)});function q(){const[e,a]=c.exports.useState([]);return c.exports.useEffect(()=>{setInterval(()=>{f.length>0&&a(t=>[f[0],t[0],t[1]].filter(Boolean)),f.shift()},3e3)},[]),c.exports.useEffect(()=>{g.get("messages/last3").then(t=>{console.log(t.data),a(t.data)})},[]),r("div",{className:m.messageListWrapper,children:[s("img",{src:Q,alt:"Do While 2021 Logo"}),s("ul",{className:m.messageList,children:e.map(t=>r("li",{className:m.message,children:[r("p",{className:m.messageContent,children:[" ",t.text," "]}),r("div",{className:m.messageUser,children:[s("div",{className:m.userImage,children:s("img",{src:t.user.avatar_url,alt:t.user.name})}),s("span",{children:t.user.name})]})]},t.id))})]})}const K="_sendMessageFormWrapper_8kl2m_1",H="_signOutButton_8kl2m_12",J="_userInformation_8kl2m_26",V="_userImage_8kl2m_31",X="_userName_8kl2m_43",Y="_userGithub_8kl2m_48",Z="_sendMessageForm_8kl2m_1";var u={sendMessageFormWrapper:K,signOutButton:H,userInformation:J,userImage:V,userName:X,userGithub:Y,sendMessageForm:Z};function ee(){const{user:e,signOut:a}=_(),[t,l]=c.exports.useState("");async function n(o){if(o.preventDefault(),!t.trim()){x("Mensagem est\xE1 vazia !",{style:{background:"red",color:"#fff",borderRadius:"none"}});return}await g.post("messages",{message:t}),console.log(t),x("Mensagem enviada com sucesso !",{style:{background:"#1B873F",color:"#fff",borderRadius:"none"}}),l("")}return r("div",{className:u.sendMessageFormWrapper,children:[s("div",{children:s(k,{position:"top-right",reverseOrder:!1})}),s("button",{onClick:a,type:"button",className:u.signOutButton,children:s(w,{size:32})}),r("header",{className:u.userInformation,children:[s("div",{className:u.userImage,children:s("img",{src:e==null?void 0:e.avatar_url,alt:e==null?void 0:e.name})}),s("strong",{className:u.userName,children:e==null?void 0:e.name}),r("span",{className:u.userGithub,children:[s(b,{size:16})," ",e==null?void 0:e.login]})]}),r("form",{onSubmit:n,className:u.sendMessageForm,method:"post",children:[s("label",{htmlFor:"message",children:"Mensagem"}),s("textarea",{name:"message",id:"message",placeholder:"Qual a sua expectativa para o evento ?",onChange:o=>l(o.target.value),value:t}),r("button",{type:"submit",children:[s(L,{size:16}),"Enviar"]})]})]})}function se(){const{user:e}=_();return r("main",{className:`${I.contentWrapper} ${e?I.contentSigned:""}`,children:[s(q,{}),e?s(ee,{}):s(j,{})]})}F.render(s(S.StrictMode,{children:s(U,{children:s(se,{})})}),document.getElementById("root"));
